{{ define "calendar" }}
{{ template "header" . }}
{{ $showAll := .showAll }}

<div class="uk-margin-top">
    <h1 class="uk-heading-medium uk-text-center">Stocker</h1>

    {{ $programName := "" }}
    {{ if eq .program "cfp" }}
    {{ $programName = "Community Fishing Program" }}
    {{ else if eq .program "winter" }}
    {{ $programName = "Winter" }}
    {{ else if eq .program "springsummer" }}
    {{ $programName = "Spring & Summer" }}
    {{ end }}
    <nav class="uk-text-center">
        <ul class="uk-breadcrumb">
            <li><a href="/">Home</a></li>
            {{ if .waters }}
            <li><a href="/{{ .program }}">{{ $programName }}</a></li>
            <li>{{ .waters }}</li>
            {{ else }}
            <li>{{ $programName }}</li>
            {{ end }}
        </ul>
    </nav>

    <div>
        <div class="uk-card uk-card-default" style="margin: 5%;">
            <div class="uk-card-body">
                <div class="uk-margin">
                    <form class="uk-form-stacked" action="/{{ .program }}" method="get">
                        <div class="uk-form-controls">
                            <select onchange="this.form.submit()" class="uk-select" name="waters">
                                <option>Choose a water</option>
                                {{ range $waterName := .allWaterNames }}
                                <option>{{ $waterName }}</option>
                                {{ end }}
                            </select>
                        </div>
                    </form>
                </div>

                <div class="uk-margin uk-flex-center uk-grid" uk-grid>
                    <form action="/{{ .program }}" method="get">
                        {{ if eq .sortedBy "last" }}
                        <button class="uk-button uk-button-primary uk-button-large">
                        {{ else }}
                        <input type="hidden" value="last" name="sortBy">
                        <button class="uk-button uk-button-default uk-button-large">
                        {{ end }}
                            Sort Recent Stocking
                        </button>
                    </form>

                    <form action="/{{ .program }}" method="get">
                        {{ if eq .sortedBy "next" }}
                        <button class="uk-button uk-button-primary uk-button-large">
                        {{ else }}
                        <input type="hidden" value="next" name="sortBy">
                        <button class="uk-button uk-button-default uk-button-large">
                        {{ end }}
                            Sort Upcoming Stocking
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {{ range $data := .calendar }}
    <div>
        <div class="uk-card uk-card-default" style="margin: 5%;">
            <div class="uk-card-header uk-text-center">
                <h3 class="uk-card-title uk-margin-remove-bottom">{{ $data.WaterName }}</h3>
            </div>
            <div class="uk-card-body">
                <dl class="uk-description-list">
                    <dt>Most recent stocking</dt>
                    {{ $lastStock := $data.Last }}
                    <dd>{{ $lastStock.Year }} {{ $lastStock.Month.String }} {{ $lastStock.Day }}: {{ $lastStock.Stock }}</dd>

                    <dt>Upcoming stocking</dt>
                    {{ $nextStock := $data.Next }}
                    <dd>{{ $nextStock.Year }} {{ $nextStock.Month.String }} {{ $nextStock.Day }}: {{ $nextStock.Stock }}</dd>

                    <dt>All Stocking Data</dt>
                    <dd>
                        <table class="uk-table uk-table-striped">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Stock</th>
                                </tr>
                            </thead>
                            <tbody>
                            {{ range $week := $data.Data }}
                                <tr>
                                    {{ if or $showAll (ne $week.Stock "None") }}
                                    <td>{{ $week.Year }} {{ $week.Month.String }} {{ $week.Day }}</td>
                                    <td>{{ $week.Stock }}</td>
                                    {{ end }}
                                </tr>
                            {{ end }}
                            </tbody>
                        </table>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
    {{ end }}
</div>
{{ template "footer" . }}
{{ end }}
